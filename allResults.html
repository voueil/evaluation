<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>All Project Results</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="styles.css">
<style>
:root {
  --lavender: #a68ed6;
  --lavender-dark: #8a6bbf;
  --lavender-light: #f4f1fa;
  --white: #ffffff;
  --text: #2d2a32;
  --border: #e5e1f1;
  --radius: 12px;
}
body {
  font-family: "Segoe UI", sans-serif;
  background: var(--lavender-light);
  color: var(--text);
  margin:0; padding:0;
}
.back-btn {
  position: fixed;
  top: 20px; left: 20px;
  background: #c6b2eb;
  color: #fff;
  padding:12px 22px;
  border-radius:16px;
  border:none;
  font-size:18px;
  font-weight:600;
  cursor:pointer;
  transition:0.2s;
  z-index:1000;
  box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
.back-btn:hover { background:#8a6bbf; }

.container { max-width:1000px; margin:28px auto; padding:16px; }
.project-card { margin-bottom:24px; padding-bottom:12px; border-bottom:1px solid var(--border); background:#fff; border-radius:var(--radius); box-shadow:0 4px 10px rgba(0,0,0,0.05); padding:16px; }
.stats { display:flex; flex-wrap:wrap; gap:12px; margin-top:8px; margin-bottom:12px; justify-content:flex-start; }
.stat { flex:1 1 160px; min-width:160px; background:#fdfaff; border:1px solid var(--border); border-radius:var(--radius); text-align:center; padding:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
.stat h4 { font-size:0.95rem; color:var(--lavender-dark); margin-bottom:0; }
.stat p { font-size:1rem; font-weight:600; margin-top:8px; color:var(--text); }
.table-wrap { overflow-x:auto; margin-top:12px; }
.table { width:100%; border-collapse:collapse; text-align:left; margin-top:8px; }
.table th, .table td { padding:8px; border-bottom:1px solid var(--border); font-size:0.95rem; text-align:left; }
.table th { color:var(--lavender-dark); background:var(--lavender-light); }
</style>
</head>
<body>

<button class="back-btn" onclick="history.back()">Back</button>

<main class="container" id="resultsContainer">
  <header class="header">
  <img src="images/logo.png" alt="Logo" class="site-logo">
  <div>All Project Results</div>
</header>
  <div id="projectsResults"></div>
</main>

<script src="app.js"></script>
<script>
document.addEventListener("DOMContentLoaded", showResults);

function showResults(){
  const projectsContainer = document.getElementById('projectsResults');
  const textMap = { 10:"Excellent", 8:"Good", 6:"Satisfactory", 2:"Needs Improvement" };

  APP.INITIAL_PROJECTS.forEach((project,id)=>{
    const data = APP.aggregate(id);

    const card = document.createElement('div');
    card.className='project-card';
    card.innerHTML = `
      <h3 style="text-align:center;">${project.name}</h3>
      <p style="text-align:center; color:var(--lavender-dark); font-weight:600;">${project.description}</p>
      <div class="stats"></div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Evaluator</th>
              ${project.type === "Agent Project" 
                ? APP.ABDULLAH_CRITERIA.map(c=>`<th>${c.label}</th>`).join('')
                : APP.DEFAULT_CRITERIA.map(c=>`<th>${c.label}</th>`).join('')}
              <th>Total Score</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    `;

    const statsDiv = card.querySelector('.stats');
    const criteriaList = project.type === "Agent Project" ? APP.ABDULLAH_CRITERIA : APP.DEFAULT_CRITERIA;
    criteriaList.forEach(c=>{
      const stat = document.createElement('div');
      stat.className='stat';
      stat.innerHTML=`<h4>${c.label}</h4><p>${data.averages[c.key] || 0}</p>`;
      statsDiv.appendChild(stat);
    });
    const totalStat = document.createElement('div');
    totalStat.className='stat';
    totalStat.innerHTML=`<h4>Total Average</h4><p>${data.averageTotal || 0}</p>`;
    statsDiv.appendChild(totalStat);

    const tbody = card.querySelector('tbody');
    if(data.entries.length === 0){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="${criteriaList.length + 3}" style="text-align:center; color:#888;">No evaluations yet</td>`;
      tbody.appendChild(tr);
    } else {
      data.entries.forEach(e=>{
        const tr = document.createElement('tr');
        const date = new Date(e.createdAt).toLocaleString();
        const criteriaCells = criteriaList.map(c=>{
          const val = e.scores[c.key];
          return `<td>${textMap[val] || val || ''}</td>`;
        }).join('');
        tr.innerHTML = `<td>${e.evaluatorName}</td>${criteriaCells}<td>${e.total}</td><td>${date}</td>`;
        tbody.appendChild(tr);
      });
    }

    projectsContainer.appendChild(card);
  });
}
</script>

</body>
</html>
